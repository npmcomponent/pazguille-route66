(function(e){"use strict";function o(e){this.init(e);return this}function u(){this.init();return this}var t=e.location,n=e.addEventListener?"addEventListener":"attachEvent",r=e.addEventListener?"load":"onload",i=e.onpopstate!==undefined,s=i?"popstate":r;o.prototype.init=function(e){this.url=e;this.listeners=[];this.toRegExp();return this};o.prototype.toRegExp=function(){this.regexp=new RegExp("^"+this.url.replace(/:\w+/g,"([^\\/]+)").replace(/\//g,"\\/")+"$");return this};u.prototype.init=function(){var r=this,o;this._collection={};e[n](s,function(){o=t.hash.split("#!")[1]||t.hash.split("#")[1];if(t.pathname==="/"&&o===undefined){r._match("/")}else{r._match(o)}},false);if(!i){e[n]("onhashchange",function(){o=t.hash.split("#!")[1]||t.hash.split("#")[1];r._match(o)})}return this};u.prototype._match=function(e){var t,n,r=0,i,s,o;for(n in this._collection){if(this._collection[n]!==undefined){i=this._collection[n];s=e.match(i.regexp);if(s){s.splice(0,1);t=this._collection[n].listeners;o=t.length;for(r;r<o;r+=1){t[r].apply(undefined,s)}}}}return this};u.prototype.path=function(e,t){var n;if(typeof e==="object"&&t===undefined){for(n in e){if(e[n]!==undefined){this._createPath(n,e[n])}}}else{this._createPath(e,t)}return this};u.prototype._createPath=function(e,t){if(this._collection[e]===undefined){this._collection[e]=new o(e)}this._collection[e].listeners.push(t)};u.prototype.remove=function(e,t){var n=this._collection[e],r=0,i=n.length;if(i!==undefined){for(r;r<i;r+=1){if(n[r]===t){n.splice(r,1);break}}}if(n.length===0||t===undefined){delete this._collection[e]}return this};u.prototype.getListeners=function(e){return e!==undefined?this._collection[e]:this._collection};if(typeof e.define==="function"&&e.define.amd!==undefined){e.define("Route66",[],function(){return u})}else if(typeof module!=="undefined"&&module.exports!==undefined){module.exports=u}else{e.Route66=u}})(this);